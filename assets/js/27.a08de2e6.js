(window.webpackJsonp=window.webpackJsonp||[]).push([[27],{416:function(t,s,a){t.exports=a.p+"assets/img/docker.5dcbb4c1.png"},417:function(t,s,a){t.exports=a.p+"assets/img/dockekHub.0625bc69.png"},418:function(t,s,a){t.exports=a.p+"assets/img/gitaction.e68b4926.png"},533:function(t,s,a){"use strict";a.r(s);var n=a(1),e=Object(n.a)({},(function(){var t=this,s=t._self._c;return s("ContentSlotsDistributor",{attrs:{"slot-key":t.$parent.slotKey}},[s("h1",{attrs:{id:"devserver-배포-자동화"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#devserver-배포-자동화"}},[t._v("#")]),t._v(" DevServer 배포 자동화")]),t._v(" "),s("p",[t._v("우선 Dev서버의 필요성을 느끼고 "),s("em",[t._v("Dev서버")]),t._v("를 구성하기로 하였다.")]),t._v(" "),s("p",[t._v("기본적인 "),s("strong",[t._v("요구조건")]),t._v("은 다음과 같다")]),t._v(" "),s("ul",[s("li",[s("strong",[t._v("Production 환경과 같은 환경")]),t._v("에서 운영될 것")]),t._v(" "),s("li",[s("strong",[t._v("Mock Server")]),t._v("로서 활용할 수 있을 것")]),t._v(" "),s("li",[s("strong",[t._v("CI/CD")]),t._v("에 의하여 소스코드메니저에 의한 자동 배포가 이루어 질 것")]),t._v(" "),s("li",[t._v("Dev Server를 "),s("strong",[t._v("로컬 환경에서도 실행")]),t._v(" 할 수 있도록 Docker hub에 구성할 것")])]),t._v(" "),s("p",[t._v("이렇게 4가지의 과제를 해결하기 위하여 여러가지 방법을 생각해고 시도해본 "),s("strong",[t._v("시행착오를")]),t._v(" 적어보도록 하겠다")]),t._v(" "),s("h2",{attrs:{id:"docker로-서버-코드-말아보기"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#docker로-서버-코드-말아보기"}},[t._v("#")]),t._v(" Docker로 서버 코드 말아보기")]),t._v(" "),s("p",[t._v("우선은 모든것의 시작은 도커를 이용하여 "),s("code",[t._v("Node")]),t._v("서버를 구성하여 올려 보도록 하자\n"),s("code",[t._v("docker")]),t._v("는 우선 "),s("code",[t._v("images")]),t._v("를 만들어 해당 이미지를 "),s("code",[t._v("Container")]),t._v("로 띄워서 가상 머신을 별다른 세팅없이 가상머신을 돌릴수 있도록 돕는 오픈소스 라이브러리 이다.")]),t._v(" "),s("p",[t._v("도커를 설치하는 것은 "),s("a",{attrs:{href:"https://docs.docker.com/engine/install/",target:"_blank",rel:"noopener noreferrer"}},[t._v("공식 홈페이지를 참조"),s("OutboundLink")],1),t._v("하도록 하자.\n*공홈에서 GitHub Action과 함께 사용하는 "),s("a",{attrs:{href:"https://youtu.be/iqqDU2crIEQ",target:"_blank",rel:"noopener noreferrer"}},[t._v("가이드 영상"),s("OutboundLink")],1),t._v("을 제공해준다")]),t._v(" "),s("p",[t._v("도커 설치가 끝났으면이제 구성된 서버를 이미지화 해보자.")]),t._v(" "),s("ol",[s("li",[s("strong",[t._v("Create "),s("code",[t._v("Dockerfile")])])])]),t._v(" "),s("p",[t._v("Docker는 "),s("code",[t._v("Dockerfile")]),t._v("에 의하여 이미지를 구성한다.")]),t._v(" "),s("blockquote",[s("p",[s("em",[t._v("Dockerfile")]),t._v("에 대한 자세한 내용은 공식 홈페이지를 참조하자. https://docs.docker.com/engine/reference/builder/")])]),t._v(" "),s("p",[t._v("참고로 본 포스팅에서 구성한 서버는 "),s("code",[t._v("nestjs")]),t._v(". 즉, "),s("code",[t._v("node")]),t._v("환경을 기반으로 구성되어 있다.")]),t._v(" "),s("p",[t._v("node용 도커파일의 "),s("a",{attrs:{href:"https://github.com/nodejs/docker-node/blob/main/docs/BestPractices.md",target:"_blank",rel:"noopener noreferrer"}},[t._v("best practice"),s("OutboundLink")],1),t._v("를 "),s("code",[t._v("node-docker")]),t._v("에서 제공하고 있으니 참고해서 작성하면 되겠다.")]),t._v(" "),s("p",[t._v("자신의 프로젝트에 맞게끔 "),s("code",[t._v("Dockerfile")]),t._v("을 작성하자.")]),t._v(" "),s("div",{staticClass:"language- extra-class"},[s("pre",{pre:!0,attrs:{class:"language-text"}},[s("code",[t._v('# Dockerfile\nFROM node:16-alpine As development\n\nWORKDIR /home/node/app\n\nCOPY package*.json ./\n\nRUN npm install\n\nCOPY . /home/node/app\n\nRUN npm run build\n\nFROM node:16 as production\n\nARG NODE_ENV=production\nENV NODE_ENV=${NODE_ENV}\n\nWORKDIR /\n\nCOPY package*.json ./\n\nRUN npm install --production\n\nCOPY --from=development /home/node/app/dist /dist\n\nEXPOSE 4000\n\nCMD [ "node", "/dist/main.js"] \n')])])]),s("ol",[s("li",[s("strong",[t._v("Docker build")])])]),t._v(" "),s("div",{staticClass:"language-bash extra-class"},[s("pre",{pre:!0,attrs:{class:"language-bash"}},[s("code",[t._v("$ Docker build "),s("span",{pre:!0,attrs:{class:"token parameter variable"}},[t._v("-t")]),t._v(" images-tag "),s("span",{pre:!0,attrs:{class:"token builtin class-name"}},[t._v(".")]),t._v("\n\n"),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("docker")]),t._v(" build "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),t._v("OPTIONS"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token environment constant"}},[t._v("PATH")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# 여기서의 PATH는 Dokerfil의 위치를 지정해 주는 것이다.")]),t._v("\n")])])]),s("div",{staticClass:"language-sh extra-class"},[s("pre",{pre:!0,attrs:{class:"language-sh"}},[s("code",[s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),t._v("+"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),t._v(" Building "),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("16")]),t._v(".6s "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("17")]),t._v("/17"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" FINISHED                                                            \n "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v(">")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),t._v("internal"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),t._v(" load build definition from Dockerfile                                      "),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("0")]),t._v(".0s\n "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v(">")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v(">")]),t._v(" transferring dockerfile: 410B                                                      "),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("0")]),t._v(".0s\n "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v(">")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),t._v("internal"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),t._v(" load .dockerignore                                                         "),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("0")]),t._v(".0s\n "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v(">")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v(">")]),t._v(" transferring context: 34B                                                          "),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("0")]),t._v(".0s\n "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v(">")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),t._v("internal"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),t._v(" load metadata "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("for")]),t._v(" docker.io/library/node:16                                "),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("2")]),t._v(".4s\n "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v(">")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),t._v("internal"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),t._v(" load metadata "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("for")]),t._v(" docker.io/library/node:16-alpine                         "),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("2")]),t._v(".4s\n "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v(">")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),t._v("auth"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),t._v(" library/node:pull token "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("for")]),t._v(" registry-1.docker.io                               "),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("0")]),t._v(".0s\n "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v(">")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),t._v("production "),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("1")]),t._v("/5"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),t._v(" FROM docker.io/library/node:16@sha256:683b8ea4ebc033a0f9060501fc31c  "),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("0")]),t._v(".0s\n "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v(">")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),t._v("development "),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("1")]),t._v("/6"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),t._v(" FROM docker.io/library/node:16-alpine@sha256:8f1827381eb7fca5a79ad  "),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("0")]),t._v(".0s\n "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v(">")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),t._v("internal"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),t._v(" load build context                                                         "),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("0")]),t._v(".1s\n "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v(">")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v(">")]),t._v(" transferring context: "),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("30")]),t._v(".90kB                                                      "),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("0")]),t._v(".0s\n "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v(">")]),t._v(" CACHED "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),t._v("development "),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("2")]),t._v("/6"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),t._v(" WORKDIR /home/node/app                                       "),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("0")]),t._v(".0s\n "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v(">")]),t._v(" CACHED "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),t._v("development "),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("3")]),t._v("/6"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),t._v(" COPY package*.json ./                                        "),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("0")]),t._v(".0s\n "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v(">")]),t._v(" CACHED "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),t._v("development "),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("4")]),t._v("/6"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),t._v(" RUN "),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("npm")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("install")]),t._v("                                              "),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("0")]),t._v(".0s\n "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v(">")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),t._v("development "),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("5")]),t._v("/6"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),t._v(" COPY "),s("span",{pre:!0,attrs:{class:"token builtin class-name"}},[t._v(".")]),t._v(" /home/node/app                                               "),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("0")]),t._v(".1s\n "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v(">")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),t._v("development "),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("6")]),t._v("/6"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),t._v(" RUN "),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("npm")]),t._v(" run build                                                  "),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("13")]),t._v(".4s\n "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v(">")]),t._v(" CACHED "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),t._v("production "),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("2")]),t._v("/5"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),t._v(" COPY package*.json ./                                         "),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("0")]),t._v(".0s \n "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v(">")]),t._v(" CACHED "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),t._v("production "),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("3")]),t._v("/5"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),t._v(" RUN "),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("npm")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("install")]),t._v("                                               "),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("0")]),t._v(".0s \n "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v(">")]),t._v(" CACHED "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),t._v("production "),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("4")]),t._v("/5"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),t._v(" COPY "),s("span",{pre:!0,attrs:{class:"token parameter variable"}},[t._v("--from")]),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v("development /home/node/app/dist /dist             "),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("0")]),t._v(".0s \n "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v(">")]),t._v(" exporting to image                                                                    "),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("0")]),t._v(".0s \n "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v(">")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v(">")]),t._v(" exporting layers                                                                   "),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("0")]),t._v(".0s\n "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v(">")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v(">")]),t._v(" writing image sha256:1ab4c88fc43519a071a1e1b3b3d4c26bd77c53eb17f675102904451f05d7  "),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("0")]),t._v(".0s\n "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v(">")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v(">")]),t._v(" naming to docker.io/library/images-tag:test                                         "),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("0")]),t._v(".0s\n")])])]),s("p",[t._v("Dockerfile이 실행되면서 Docker imge를 생성하는 과정을 로그로 확인할 수 있다.")]),t._v(" "),s("ol",{attrs:{start:"3"}},[s("li",[s("strong",[t._v("Container 띄우기")])])]),t._v(" "),s("p",[t._v("이제 만들어진 이미지를 확인하고 컨테이너로 띄워보자.")]),t._v(" "),s("div",{staticClass:"language-bash extra-class"},[s("pre",{pre:!0,attrs:{class:"language-bash"}},[s("code",[t._v("$ "),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("docker")]),t._v(" images\n\nREPOSITORY   TAG       IMAGE ID       CREATED          SIZE\nimages-tag   latest    0ba9d8d1a439   "),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("24")]),t._v(" minutes ago   984MB\n")])])]),s("p",[t._v("build된 이미지 repo list를 확인할 수 있다.")]),t._v(" "),s("p",[s("code",[t._v("Container")]),t._v("는 이러한 이미지를 "),s("code",[t._v("Docker run")]),t._v(" 명령을 통해 실행 시키는 것으로 Container를 실행시킬 수 있다.")]),t._v(" "),s("div",{staticClass:"language-bash extra-class"},[s("pre",{pre:!0,attrs:{class:"language-bash"}},[s("code",[t._v("$ "),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("docker")]),t._v(" run "),s("span",{pre:!0,attrs:{class:"token parameter variable"}},[t._v("-d")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token parameter variable"}},[t._v("-p")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("4000")]),t._v(":4000 "),s("span",{pre:!0,attrs:{class:"token parameter variable"}},[t._v("--rm")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token parameter variable"}},[t._v("--name")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("<")]),t._v("Container_name"),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v(">")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("<")]),t._v("image:tag or image ID"),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v(">")]),t._v("\n")])])]),s("p",[t._v("위의 자세한 Option은 "),s("code",[t._v("docker run --help")]),t._v("를 통해알아보자.")]),t._v(" "),s("p",[t._v("하지만 위의 옵션은 Container를 실행해보고 테스트하기에 적절하니 기억해두면 좋다.")]),t._v(" "),s("ul",[s("li",[s("code",[t._v("-p")]),t._v(": "),s("code",[t._v("<Container port>:<Host port>")]),t._v("가 되겠다. 즉 앞의 포트는 도커가 열리는 포트, 뒤에 포트는 내가 작성한 코드에서 여는 포트가 되겠다.")]),t._v(" "),s("li",[s("code",[t._v("-d")]),t._v(": detach. 백그라운드에서 실행시킨다.")]),t._v(" "),s("li",[s("code",[t._v("--rm")]),t._v(": Container "),s("strong",[t._v("종료와 동시에 삭제한다")]),t._v(" 이게 생각보다 유용하다.")]),t._v(" "),s("li",[s("code",[t._v("--name")]),t._v(": 이름을 정해준다. 안정하면 이름이 임의로 생성된다.")])]),t._v(" "),s("p",[t._v("이렇게 Container를 실행하면 "),s("code",[t._v("docker ps")]),t._v("를 통해 "),s("strong",[t._v("실행중인")]),t._v(" Container를 조회할 수 있다.")]),t._v(" "),s("div",{staticClass:"language-bash extra-class"},[s("pre",{pre:!0,attrs:{class:"language-bash"}},[s("code",[t._v("$ "),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("docker")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("ps")]),t._v("\n\nCONTAINER ID   IMAGE               COMMAND                  CREATED          STATUS          PORTS      NAMES\nb2b3638cb8c6   images-tag:latest   "),s("span",{pre:!0,attrs:{class:"token string"}},[t._v('"docker-entrypoint.s…"')]),t._v("   "),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("26")]),t._v(" seconds ago   Up "),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("25")]),t._v(" seconds   "),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("4000")]),t._v("/tcp   test_container\n")])])]),s("p",[t._v("그다음에 열어둔 포트를 "),s("code",[t._v("http://localhost:4000")]),t._v("아와 같이 접속하면 페이지를 잘 확인할 수 있어야한다.")]),t._v(" "),s("p",[s("img",{attrs:{src:a(416),alt:"example"}})]),t._v(" "),s("p",[t._v("처음으로 올린 "),s("strong",[t._v("Docker Container")]),t._v("가 완성되었다.")]),t._v(" "),s("ol",{attrs:{start:"4"}},[s("li",[s("strong",[t._v("Docker hub 이용해서 image 공유하기")])])]),t._v(" "),s("blockquote",[s("p",[t._v("이 부분은 Docker hub에 대한 이해를 돕는 부분이다.")])]),t._v(" "),s("p",[s("strong",[t._v("Docker hub계정이 있고 이미 사용경험이 있다면 과감히 건너뛰는 것을 권장한다.")])]),t._v(" "),s("ul",[s("li",[s("p",[t._v("우선 Docker hub를 이용하기 위해 "),s("em",[t._v("Docker hub 계정을 만들고 로그인해보자")])]),t._v(" "),s("p",[t._v("그럼 아래와 유사한 화면("),s("s",[t._v("이미 저는 테스트해본 Repo가 있는 상태입니다")]),t._v(")")]),t._v(" "),s("p",[s("img",{attrs:{src:a(417),alt:"example2"}})])]),t._v(" "),s("li",[s("p",[t._v("이렇게 자신의 "),s("strong",[t._v("docker hub")]),t._v("에 잘 들어가 졌다면이제 image를 Push 해보자")]),t._v(" "),s("div",{staticClass:"language-bash extra-class"},[s("pre",{pre:!0,attrs:{class:"language-bash"}},[s("code",[t._v("$ "),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("docker")]),t._v(" push "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("<")]),t._v("Username"),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v(">")]),t._v("/"),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("<")]),t._v("image"),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v(">")]),t._v(":"),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("<")]),t._v("image-tag"),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v(">")]),t._v("\n")])])]),s("p",[t._v("하지만 이렇게 해보면 이미지를 찾을 수 없다고 한다...")]),t._v(" "),s("p",[t._v("Push 할때 "),s("strong",[t._v("Username까지 포함한 image를 local에 생성한 뒤")]),t._v("에 Push해야 하기 때문이다.")]),t._v(" "),s("div",{staticClass:"language-bash extra-class"},[s("pre",{pre:!0,attrs:{class:"language-bash"}},[s("code",[t._v("$ "),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("docker")]),t._v(" tag "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("<")]),t._v("image"),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v(">")]),t._v(":"),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("<")]),t._v("image-tag"),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v(">")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("<")]),t._v("Username"),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v(">")]),t._v("/"),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("<")]),t._v("image"),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v(">")]),t._v(":"),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("<")]),t._v("image-tag"),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v(">")]),t._v("\n")])])]),s("p",[t._v("이다음에 푸시를 위에 실행했던 Push를 실행해보면 잘 수행되는 것을 볼 수 있다.")]),t._v(" "),s("p",[t._v("이렇게 "),s("code",[t._v("image")]),t._v("를 밀어넣어주면 "),s("strong",[t._v("Docker hub에 저처럼 리스트가 생성")]),t._v("됐을 겁니다.")])]),t._v(" "),s("li",[s("p",[t._v("이제 어디서든 "),s("strong",[t._v("docker hub에서 image를 pull 받아와서 실행할")]),t._v(" 수 있다.")]),t._v(" "),s("p",[t._v("그 전에 우선 local에 생성한 image를 삭제하고 당겨와서 테스트를 해보자")]),t._v(" "),s("div",{staticClass:"language-bash extra-class"},[s("pre",{pre:!0,attrs:{class:"language-bash"}},[s("code",[t._v("$ "),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("docker")]),t._v(" images\n\nREPOSITORY            TAG       IMAGE ID       CREATED          SIZE\nimages-tag            latest    0ba9d8d1a439   "),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("24")]),t._v(" minutes ago   984MB\nUsername/images-tag   latest    41dd421a452f   "),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("4")]),t._v(" minutes ago    984MB\n")])])]),s("div",{staticClass:"language-bash extra-class"},[s("pre",{pre:!0,attrs:{class:"language-bash"}},[s("code",[t._v("$ "),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("docker")]),t._v(" rmi "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("<")]),t._v("Username"),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v(">")]),t._v("/"),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("<")]),t._v("image"),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v(">")]),t._v(":"),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("<")]),t._v("image-tag"),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v(">")]),t._v("\n")])])]),s("div",{staticClass:"language-bash extra-class"},[s("pre",{pre:!0,attrs:{class:"language-bash"}},[s("code",[t._v("$ "),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("docker")]),t._v(" images\n\nREPOSITORY   TAG       IMAGE ID       CREATED          SIZE\nimages-tag   latest    0ba9d8d1a439   "),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("24")]),t._v(" minutes ago   984MB\n")])])]),s("p",[t._v("깔끔히 삭제가 이루어졌다면 이제 Pull을 당겨와서 Container를 실행시켜보자")]),t._v(" "),s("div",{staticClass:"language-bash extra-class"},[s("pre",{pre:!0,attrs:{class:"language-bash"}},[s("code",[t._v("$ "),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("docker")]),t._v(" pull "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("<")]),t._v("Username"),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v(">")]),t._v("/"),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("<")]),t._v("image"),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v(">")]),t._v(":"),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("<")]),t._v("image-tag"),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v(">")]),t._v("\n\n$ "),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("docker")]),t._v(" images\n\nREPOSITORY            TAG       IMAGE ID       CREATED          SIZE\nimages-tag            latest    0ba9d8d1a439   "),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("24")]),t._v(" minutes ago   984MB\nUsername/images-tag   latest    41dd421a452f   "),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("1")]),t._v(" minutes ago    984MB\n")])])]),s("p",[t._v("이렇게 당겨온 image를 run을 통해 실행하면 local에서 만들었던 Container와 똑같이 동작하는 것을 볼 수 있다.")])])]),t._v(" "),s("h2",{attrs:{id:"docker-github-action으로-배포하기"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#docker-github-action으로-배포하기"}},[t._v("#")]),t._v(" Docker Github Action으로 배포하기")]),t._v(" "),s("p",[t._v("이제 "),s("code",[t._v("Docker")]),t._v("와 "),s("code",[t._v("Docker hub")]),t._v("에 대하여 알아보았으니 이를 CI/CD를 입혀보자.")]),t._v(" "),s("ul",[s("li",[t._v("CircleCI")]),t._v(" "),s("li",[t._v("gitlab")]),t._v(" "),s("li",[t._v("bamboo")]),t._v(" "),s("li",[t._v("github")]),t._v(" "),s("li",[t._v("etc")])]),t._v(" "),s("p",[t._v("다양한 CI/CD 서비스에서 docker hub에 이미지를 올려 배포할 수 있으나")]),t._v(" "),s("p",[t._v("본 포스팅에서는 "),s("strong",[s("code",[t._v("Github action")]),t._v("을")]),t._v(" 이용하도록 하겠다.")]),t._v(" "),s("blockquote",[s("p",[t._v("Git Action은 크게 2단계로 나누어 구성하도록 하였다\n1단계는 Pull Request때 테스트 자동화를 위한 Codecov를 이용한 testReport와\ndocker hub에 버전을 만들어 자동으로 push를 진행하고\n2단계는 Push(merge)때 만들어진 latest 버전의 도커 Image를 배포하도록 구성하는 방법을 알아보자")])]),t._v(" "),s("ol",[s("li",[s("strong",[t._v("Git Action을 통한 test 자동화와 Docker hub 구성하기")])])]),t._v(" "),s("p",[t._v("우선 Git Action으로 가서 "),s("code",[t._v("New workflow")]),t._v("를 통해 새로운 일거리(job)을 만들어주자")]),t._v(" "),s("p",[s("img",{attrs:{src:a(418),alt:"gitaction"}})]),t._v(" "),s("div",{staticClass:"language-yml extra-class"},[s("pre",{pre:!0,attrs:{class:"language-yml"}},[s("code",[s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# This is a basic workflow to help you get started with Actions")]),t._v("\n\n"),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("name")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" CI to Docker hub\n\n"),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# Controls when the workflow will run")]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("on")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n  "),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# PR이 들어오면 실행된다.")]),t._v("\n  "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("pull_request")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n    "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("branches")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),t._v("master"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),t._v("\n\n"),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# 소일거리를 주자")]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("jobs")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n  "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("test")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n    "),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# 운영체제를 선택한다.")]),t._v("\n    "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("runs-on")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" ubuntu"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v("latest\n\n    "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("steps")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n      "),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("#현재 PR이 되는 Branch로 체크아웃한다.")]),t._v("\n      "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("name")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" Check Out Repo\n        "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("uses")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" actions/checkout@v2\n\n      "),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("#node를 설치한다")]),t._v("\n      "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("uses")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" actions/setup"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v("node@v2\n        "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("with")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n          "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("node-version")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token string"}},[t._v("'16'")]),t._v("\n\n      "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("name")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" install node package\n        "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("run")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" npm install\n      "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("name")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" run test\n        "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("run")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" npm run test\n\n      "),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# codecov를 action에서 실행해서 report를 남기도록 한다.")]),t._v("\n      "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("name")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" Codecov\n        "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("uses")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" codecov/codecov"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v("action@v2\n        "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("with")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n          "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("token")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" $"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v(" secrets.CODECOV_TOKEN "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n          "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("flags")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" unittests\n\n  "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("build")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n    "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("runs-on")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" ubuntu"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v("latest\n\n    "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("steps")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n      "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("name")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" Check Out Repo\n        "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("uses")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" actions/checkout@v2\n\n      "),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# docker hub에 접근할 수 있는 토큰을 이용하여 Docker hub에 접근한다.")]),t._v("\n      "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("name")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" Login to Docker Hub\n        "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("uses")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" docker/login"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v("action@v1\n        "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("with")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n          "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("username")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" $"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v(" secrets.DOCKER_HUB_USERNAME "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n          "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("password")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" $"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v(" secrets.DOCKER_HUB_ACCESS_TOKEN "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n\n      "),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# 요부분은 Docker에서 지원하는 Plugin을 살펴보자")]),t._v("\n      "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("name")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" Set up Docker Buildx\n        "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("id")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" buildx\n        "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("uses")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" docker/setup"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v("buildx"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v("action@v1\n\n      "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("name")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" Build and push\n        "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("id")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" docker_build\n        "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("uses")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" docker/build"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v("push"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v("action@v2\n        "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("with")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n          "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("context")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" ./\n          "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("file")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" ./Dockerfile\n          "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("push")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token boolean important"}},[t._v("true")]),t._v("\n          "),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("#docker hub에 Username과 event number를 통해서 버전관리를 해주자.")]),t._v("\n          "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("tags")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" $"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v(" secrets.DOCKER_HUB_USERNAME "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("/images"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v("tag"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("$"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v(" github.event.number "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("$"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v(" secrets.DOCKER_HUB_USERNAME "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("/images"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v("tag"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("latest\n\n      "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("name")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" Image digest\n        "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("run")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" echo $"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v(" steps.docker_build.outputs.digest "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n")])])]),s("p",[t._v("*대부분 주석으로 설명을 붙였지만 Secret은 본인의 git repo setting에서 직접 해당 Key: value를 설정해 줘야하니 참고하자")]),t._v(" "),s("p",[t._v("이렇게 해두면 PR이 들어오는 것과 동시에 Github Action이 실행되고,")]),t._v(" "),s("p",[t._v("TEST와 build를 실행한다.")]),t._v(" "),s("ol",{attrs:{start:"2"}},[s("li",[t._v("이제는 배포의 차례이다.")])]),t._v(" "),s("p",[t._v("배포의 단계는 2단계로 나뉜다.")]),t._v(" "),s("p",[t._v("scp를 통해서 "),s("code",[t._v("Docker-compose.yml")]),t._v(" Workdir로 복사해가기(Docker-compose에 대해서는 아래에서 더 자세히 설명하니 우선 넘어가자)")]),t._v(" "),s("p",[t._v("ssh-action을 통해서 지정한 shell script를 실행하자.")]),t._v(" "),s("p",[t._v("간단히 Yml만 확인해보고 Docker-compose에 대하여 알아보자.")]),t._v(" "),s("div",{staticClass:"language-yml extra-class"},[s("pre",{pre:!0,attrs:{class:"language-yml"}},[s("code",[s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("build")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n  "),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# The type of runner that the job will run on")]),t._v("\n  "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("runs-on")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" ubuntu"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v("latest\n\n  "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("steps")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n    "),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# 하위 작업에서 Docker-compose.yml 파일을 복사해오도록 하자.")]),t._v("\n    "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("uses")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" actions/checkout@master\n    "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("name")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" copy docker"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v("compose via ssh password\n      "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("uses")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" appleboy/scp"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v("action@master\n      "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("with")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n        "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("host")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" $"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v(" secrets.HOST "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n        "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("username")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" $"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v(" secrets.USERNAME "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n        "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("key")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" $"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v(" secrets.SSHKEY "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n        "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("source")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token string"}},[t._v("'./docker-compose.yml'")]),t._v("\n        "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("target")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token string"}},[t._v("'.'")]),t._v("\n\n    "),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# 하위 작없에서 nginx config를 복사해오도록 해주었다.(Optional)")]),t._v("\n    "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("uses")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" actions/checkout@master\n    "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("name")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" copy docker"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v("compose via ssh password\n      "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("uses")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" appleboy/scp"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v("action@master\n      "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("with")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n        "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("host")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" $"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v(" secrets.HOST "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n        "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("username")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" $"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v(" secrets.USERNAME "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n        "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("key")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" $"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v(" secrets.SSHKEY "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n        "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("source")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token string"}},[t._v("'./templates/*'")]),t._v("\n        "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("target")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token string"}},[t._v("'./templates/'")]),t._v("\n\n    "),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# Dokcer compose 커멘드라인을 이용해서 ")]),t._v("\n    "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("name")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" executing remote ssh commands using password\n      "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("uses")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" appleboy/ssh"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v("action@master\n      "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("with")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n        "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("host")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" $"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v(" secrets.HOST "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n        "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("username")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" $"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v(" secrets.USERNAME "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n        "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("key")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" $"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v(" secrets.SSHKEY "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n        "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("script")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("|")]),s("span",{pre:!0,attrs:{class:"token scalar string"}},[t._v("\n          docker pull ${{ secrets.DOCKER_HUB_USERNAME }}/images-tag:latest\n          docker-compose down\n          docker-compose up -d")]),t._v("\n")])])]),s("h2",{attrs:{id:"docker-compose"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#docker-compose"}},[t._v("#")]),t._v(" Docker-compose")]),t._v(" "),s("p",[t._v("여기서 Docker-compose에 대해서 자세히 다뤄보자.")]),t._v(" "),s("p",[s("strong",[s("code",[t._v("Compose")]),t._v("는 다중 컨테이너 Docker 애플리케이션을 정의하고 실행하기 위한 도구이다.")]),t._v(" "),s("code",[t._v(".yml")]),t._v("확장자를 이용하여 "),s("strong",[t._v("YAML 파일을 사용하여 어플리케이션 서비스를 구성")]),t._v("할 수 있다.")]),t._v(" "),s("p",[t._v("Docker compose가 제공하는 효과적인 기능에 대하여 알아보자")]),t._v(" "),s("ul",[s("li",[s("strong",[t._v("단일 호스트에서 여러 개의 격리된 환경 구성")])]),t._v(" "),s("li",[s("strong",[t._v("컨테이너 생성 시 볼륨 데이터 보존")])]),t._v(" "),s("li",[s("strong",[t._v("변경된 Container만 재셍성")])]),t._v(" "),s("li",[s("strong",[t._v("환경 간의 변수와 컴포지션 이동")])])]),t._v(" "),s("ol",[s("li",[s("p",[s("strong",[t._v("단일 호스트에서 여러 개의 격리된 환경 구성")])]),t._v(" "),s("p",[s("code",[t._v("Compose")]),t._v("는 프로젝트 이름을 사용하여 환경을 서로 독립적으로 실행한다. 여러 다른 Context에서 이프로젝트 이름을 사용할 수 잇다. "),s("strong",[t._v("예를 들어보자")])]),t._v(" "),s("ul",[s("li",[t._v("Dev Host에서 프로젝트의 각 기능 분기에 대해 안정적인 복사본을 실행하려는 경우처럼 하나의 환경의 여러 복사본을 만들기 위해사용할 수 있다.")]),t._v(" "),s("li",[t._v("CI Server 환경에서 빌드가 서로 간섭하지 않도록 하려면 프로젝트 이름을 고유한 빌드 번호로 설정할 수 있다.")]),t._v(" "),s("li",[t._v("공유 Host 또는 Dev Host 환경에서 동일한 서비스 이름을 사용할 수 있는 다른 프로젝트가 서로 간섭하는 것을 방지")])])]),t._v(" "),s("li",[s("p",[s("strong",[t._v("컨테이너 생성 시 볼륨 데이터 보존")])]),t._v(" "),s("p",[s("code",[t._v("Compose")]),t._v("는 서비스에서 사용하는 모든 볼륨을 보존한다. "),s("code",[t._v("docker-compose up")]),t._v("이 실행될 때 "),s("strong",[t._v("이전 실행에서 컨텡너를 찾으면 이전 컨테이너에서 새 컨테이너로 볼륨을 복사")]),t._v("합니다.")]),t._v(" "),s("p",[t._v("이 프로세스는 볼륨에서 생성한 모든 데이터가 손실되지 않도록 합니다.")])]),t._v(" "),s("li",[s("p",[s("strong",[t._v("변경된 Container만 재생성")])]),t._v(" "),s("p",[s("code",[t._v("Compose")]),t._v("는 컨테이너를 만드는 데 사용된 구성을 캐싱한다. 변경되지 않은 서비스는 다시 시작할 때 기존의 컨테이너를 재사용한다. 우린 덕분에 "),s("strong",[t._v("빠르게 환경을 구성하고 변경할 수 있다.")])])]),t._v(" "),s("li",[s("p",[s("strong",[t._v("환경 간의 변수와 컴포지션 이동")])]),t._v(" "),s("p",[s("code",[t._v("Compose")]),t._v("는 `Compose 파일의 변수를 지원한다. 이러한 변수를 사용함으로서 "),s("strong",[t._v("다양한 환경 또는 다른 사용자에맞는 구성을 사용자가 지정할 수 있다.")])])])]),t._v(" "),s("p",[t._v("위 내용을 간단히 이해 한다면 어떤때에 "),s("code",[t._v("Compose")]),t._v("를 구성하면 좋을지 전략을 세울수 있다.")]),t._v(" "),s("p",[t._v("본론으로 들어가서 "),s("strong",[t._v("컴포저 구성")]),t._v("은 어떻게 하였는지 함께 살펴보자")]),t._v(" "),s("p",[t._v("Compose 파일에서는 "),s("strong",[t._v("Service, NetWork, Volume")]),t._v("을 정의한다.")]),t._v(" "),s("p",[t._v("파일 명세의 자세한 내용은 워낙에 방대하니 따로 다루지 않겠다.*"),s("a",{attrs:{href:"https://docs.docker.com/compose/compose-file/compose-file-v3/",target:"_blank",rel:"noopener noreferrer"}},[t._v("자세한 내용은 홈페이지를 참고"),s("OutboundLink")],1)]),t._v(" "),s("div",{staticClass:"language-yml extra-class"},[s("pre",{pre:!0,attrs:{class:"language-yml"}},[s("code",[s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("version")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token string"}},[t._v("'3'")]),t._v("\n\n"),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("services")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n  "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("devserver")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n    "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("image")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" USER_NAME/IMAGE_NAME"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("TAG\n    "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("container_name")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" devserver\n    "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("build")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n      "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("context")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" .\n      "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("dockerfile")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" Dockerfile\n    "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("volumes")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n      "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v(" ."),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("/code\n      "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v(" /code/node_modules\n    "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("networks")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n      "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v(" app"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v("network\n    "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("ports")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n      "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v(" 4000"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("4000")]),t._v("\n\n  "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("web")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n    "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("image")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" nginx"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("mainline"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v("alpine\n    "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("container_name")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" nginx\n    "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("restart")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" on"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v("failure"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("30")]),t._v("\n    "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("tty")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token boolean important"}},[t._v("true")]),t._v("\n    "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("volumes")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n      "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v(" ./templates"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("/etc/nginx/conf.d\n    "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("ports")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n      "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token string"}},[t._v("'80:80'")]),t._v("\n    "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("networks")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n      "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v(" app"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v("network\n    "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("depends_on")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n      "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v(" devserver\n\n"),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("networks")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n  "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("app-network")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n    "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("driver")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" bridge\n")])])]),s("p",[t._v("이렇게 만들어둔 "),s("code",[t._v("docker-compose.yml")]),t._v("을 scp를 통하여 복사하고, 복사한 Compose를 "),s("code",[t._v("docker-compose up")]),t._v("을 통하여 실행한 것이다.")]),t._v(" "),s("p",[t._v("현재 작성자의 환경은 Digitalocean에 Droplet을 이용한 DevServer환경임을 참고하자.")]),t._v(" "),s("p",[t._v("AWS라면 NGiNX 없이 구성할 수 있지만 이런 경우에는 권한과 key관리 문제가 있을수 있으니 참고하자.")]),t._v(" "),s("p",[t._v("이상으로 Docker - github action - digitaloean - nginx 를 적절히 사용하여 배포하는 node 환경 서버에 대하여 알아보았다.")])])}),[],!1,null,null,null);s.default=e.exports}}]);